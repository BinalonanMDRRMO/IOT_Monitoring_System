#define BLYNK_PRINT Serial
#include <ESP8266WiFi.h> // Library for wifi module
#include <BlynkSimpleEsp8266.h> // Library of Blynk App
#include <HCSR04.h> // Library of Ultrasonic Sensor
#include <DHT.h> // Library of Temp and Hum Sensor
#include <SimpleTimer.h> 
#include <SPI.h>
#define trig D6 // Trigger wire to Pin D6
#define echo D5 // Echo wire to Pin D5
#define DHTPIN 2 // Out wire to Pin D4
#define DHTTYPE DHT22 // setting name of DHTTYPE
DHT dht(DHTPIN, DHTTYPE); // Temp 
HCSR04 hc(trig, echo); // Ultrasonic
BlynkTimer timer; 
long distancecm = 400; // distance from ground to ultra in CM
long distancepercent = 400; // distance from ground to ultra in CM


char auth[] = "ZgbawEbNxkMNi7XW56pWwJ7vuPm7AGcs"; //your auth from Blynk
char ssid[] = "HUAWEI-2.4G-V6Gj";  // your ssid
char pass[] = "Hqd3AUkD";          // your pass


// code for Centimeter
void waterLevelcm() {
  digitalWrite(trig, LOW);
  delayMicroseconds(1);
  digitalWrite(trig, HIGH);
  delayMicroseconds(10);
  digitalWrite(trig, LOW);
  long t = pulseIn(echo, HIGH);
  long cm = t / 29 / 2;
  Serial.println(cm);
  double level = distancecm - cm;
  if (level > 0) {
    long centimeter = ((level / distancecm)) * 400;
    Blynk.virtualWrite(V0, centimeter);
  } else {
    Blynk.virtualWrite(V0, 0);
  }
}


// code for Percentage
void waterLevelpercent() {
  digitalWrite(trig, LOW);
  delayMicroseconds(1);
  digitalWrite(trig, HIGH);
  delayMicroseconds(10);
  digitalWrite(trig, LOW);
  long t = pulseIn(echo, HIGH);
  long cm = t / 29 / 2;
  Serial.println(cm);
  double level = distancepercent - cm;
  if (level > 0) {
    long percentage = ((level / distancepercent)) * 100;
    Blynk.virtualWrite(V1, percentage);
  } else {
    Blynk.virtualWrite(V1, 0);
  }
}


// code fore Humidity and Tepm Sensor
void sendSensor() {
  float h = dht.readHumidity();
  float t = dht.readTemperature();  // or dht.readTemperature(true) for Fahrenheit

  if (isnan(h) || isnan(t)) {
    Serial.println("Failed to read from DHT sensor!");
    return;
  }
  Blynk.virtualWrite(V5, h);  //V5 is for Humidity
  Blynk.virtualWrite(V6, t);  //V6 is for Temperature
}


void setup() {
  pinMode(trig, OUTPUT);
  pinMode(echo, INPUT);
  Serial.begin(9600);
  delay(100);
  Blynk.begin(auth, ssid, pass);
  timer.setInterval(10L, waterLevelcm);
  timer.setInterval(10L, waterLevelpercent);

  Serial.begin(9600);  // See the connection status in Serial Monitor
  Blynk.begin(auth, ssid, pass);

  dht.begin();

  // Setup a function to be called every second
  timer.setInterval(1000L, sendSensor);
}


void loop() {
  Blynk.run();
  timer.run();
}
